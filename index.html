<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Êô∫ËÉΩÊâìÂç°Á≥ªÁµ±</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body{font-family:"Noto Sans TC";background:#f0f4f8;display:flex;justify-content:center}
.card{background:#fff;width:95%;max-width:480px;border-radius:20px;padding:25px;box-shadow:0 15px 30px rgba(0,0,0,.15)}
#todayRecords{cursor:pointer}
#todayRecords span{display:block;border-left:3px solid #3498db;padding-left:6px;margin:4px 0}
</style>
</head>
<body>
<div class="card">
  <h2 id="userInfo">ËºâÂÖ•‰∏≠...</h2>
  <div id="statusInfo">ÂÆö‰Ωç‰∏≠...</div>
  <div id="dateTime"></div>
  <button id="btnStart">‰∏äÁè≠</button>
  <button id="btnEnd">‰∏ãÁè≠</button>
  <div id="todayRecords">‰ªäÊó•ÊâìÂç°Á¥ÄÈåÑÔºàÈªûÊìäÊõ¥Êñ∞Ôºâ</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycby3D5dyTNfRpayaPD17AKjgAawnnvYRERACwQYu4ulH2u_zoApUlzi74gvOyBnKO2oqyQ/exec";
let userId="", userName="";

async function init(){
  await liff.init({liffId:"2008786085-L1CtKqqv"});
  if(!liff.isLoggedIn()) liff.login();
  const p=await liff.getProfile();
  userId=p.userId; userName=p.displayName;
  userInfo.textContent=userName+" ÊÇ®Â•Ω";
  updateTodayRecords();
}

function buildFlex(data){
  const color=data.status==="‰∏äÁè≠"?"#3498db":"#2ecc71";
  return {
    type:"bubble",
    body:{
      type:"box",
      layout:"vertical",
      contents:[
        {type:"text",text:`${data.status}ÊâìÂç°`,size:"lg",weight:"bold",color},
        {type:"text",text:`${data.date} ${data.time}`},
        {type:"text",text:`üè¢ ${data.company}`},
        {type:"text",text:data.rangeStatus}
      ]
    }
  };
}

async function clock(status){
  const gps=await new Promise(r=>navigator.geolocation.getCurrentPosition(p=>r({
    lat:p.coords.latitude,lng:p.coords.longitude
  })));
  const res=await fetch(API,{method:"POST",body:JSON.stringify({
    userId,userName,status,gps,ip:""
  })});
  const d=await res.json();

  Swal.fire("ÂÆåÊàê",`${status} ${d.time}`,"success");

  if(liff.isInClient()){
    await liff.sendMessages([{
      type:"flex",
      altText:"ÊâìÂç°ÂÆåÊàê",
      contents:buildFlex(d)
    }]);
  }
  updateTodayRecords();
}

async function updateTodayRecords(){
  todayRecords.innerHTML="ËºâÂÖ•‰∏≠...";
  const d=await fetch(`${API}?action=getToday&userId=${userId}&date=${new Date().toISOString().slice(0,10).replace(/-/g,"/")}`).then(r=>r.json());
  todayRecords.innerHTML="‰ªäÊó•ÊâìÂç°Á¥ÄÈåÑÔºö<br>";
  d.forEach(r=>{
    todayRecords.innerHTML+=`<span>${r.status}Ôºö${r.time}Ôºà${r.company}Ôºâ</span>`;
  });
}

btnStart.onclick=()=>clock("‰∏äÁè≠");
btnEnd.onclick=()=>clock("‰∏ãÁè≠");
todayRecords.onclick=updateTodayRecords;

init();
</script>
</body>
</html>





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































